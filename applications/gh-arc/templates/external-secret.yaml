{{ if .Capabilities.APIVersions.Has "external-secrets.io/v1beta1" -}}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: gh-arc-vault-secret
---
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: gh-arc-vault-secret
spec:
  provider:
    vault:
      server: "http://vault-active.vault:8200"
      path: system/gh-arc
      version: v2
      auth:
        kubernetes:
          mountPath: kubernetes
          role: gh-arc
          serviceAccountRef:
            name: gh-arc-vault-secret
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gh-arc-vault-secret
spec:
  secretStoreRef:
    name: gh-arc-vault-secret
    kind: SecretStore
  target:
    name: gh-arc-vault-secret
  data:
    - remoteRef:
        key: application
        property:  github_app_id
      secretKey:  github_app_id
    - remoteRef:
        key: application
        property:  github_app_installation_id
      secretKey:  github_app_installation_id
    - remoteRef:
        key: application
        property:  github_app_private_key
      secretKey:  github_app_private_key
{{ end }}